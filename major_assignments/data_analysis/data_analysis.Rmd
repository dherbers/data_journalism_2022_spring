---
title: "data_analysis.rmd"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**Load and Clean Data**
This data is already very clean, there are raw rows present indicating how the Stanford team probably changed things. We did not immediately see anything that needed to be cleaned, but when we start working with specific elements of the data, we wil have to do a lot of dropping N/A values and assigning value to N/A rows to make our calculations. We should be able to answer all of the questions, we intentionally chose San Diego because it had the data available that we wanted to look at. There are plenty of values, 383,027 stops recorded with 21 different parameters. There is also a shape file, so we might be able to create some maps. 

```{r}
library(tidyverse)
library(janitor)
library(lubridate)
library(tigris)
library(tidycensus)
library(ggrepel)
library(sf)
san_diego_stops <- read_rds("data/yg821jf8611_ca_san_diego_2020_04_01.rds")
```

**Question 1:**
What age groups are stopped at the highest rate when age is known? 
**Answer**
25 to 35 year old drivers account for the largest portion of people stopped when age is known. The total increases and decreases on a steady curve before and after this category.

```{r}
age_grouped_san_diego <-san_diego_stops %>%
mutate(
  age_group = case_when(
    subject_age < 18 ~ 'under_18',
    subject_age >=18 & subject_age < 25 ~ '18_25',
    subject_age >= 25 & subject_age < 35 ~ '25_35',
    subject_age >= 35 & subject_age < 45 ~ '35_45',
    subject_age >= 45 & subject_age < 55 ~ '45_55',
   subject_age >= 55 & subject_age < 65 ~ '55_65',
   subject_age >= 65 ~'65+'
))

age_grouped_san_diego <- age_grouped_san_diego %>%
  drop_na(age_group)

age_group_counts <- age_grouped_san_diego %>%
  group_by(age_group) %>%
  summarise(count=n())
```


**Question 2:**
Which age group is most often searched for contraband when they are stopped?
**Answer**
5.7% of 18 to 25 year old drivers were searched when stopped, which is 0.6% more than the 25 to 35 age category.

```{r}
searches_age_groups_san_diego <- age_grouped_san_diego %>%
  filter(search_conducted == "TRUE") %>%
  drop_na(age_group) %>%
  group_by(age_group) %>%
  summarise(count=n())

percentage_search <- age_group_counts %>%
    inner_join(searches_age_groups_san_diego, by=c("age_group")) %>%
    rename(total=count.x,search=count.y)

percentage_search <- percentage_search %>%
  mutate(percent_search=(search/total)*100)
```


**Question 3**
When a search is performed, what group most often had contraband? AKA How often were police correct in conducting searches?

**Answer**
11.3% of 45 to 55 year old drivers had contraband found when they were searched, followed by 10.3% of 18 to 25 year old drivers and 10.1% of drivers under 18. The percentage of drivers stopped with contraband found in 25 to 35 is comparatively low with 8.9%

```{r}
searches_age_groups_contraband <- age_grouped_san_diego %>%
    filter(search_conducted == "TRUE", contraband_found == "TRUE") %>%
    group_by(age_group) %>%
    summarise(count=n())

percentage_search_contraband <- percentage_search %>%
    inner_join(searches_age_groups_contraband, by=c("age_group")) %>%
    rename(contraband=count)

percentage_search_contraband <- percentage_search_contraband %>%
  mutate(percent_contraband=(contraband/search)*100)

```


**Question #4**
Within the age groups with the identified age groups that have inconsistencies in searches and contraband found, how does race break down? Are people of a certain race being searched without contraband found at a higher rate?

**Answer**

```{r}
searches_by_age_and_race <- age_grouped_san_diego %>%
  drop_na(subject_age)%>%
  filter(search_conducted == "TRUE")%>%
  group_by(age_group, subject_race) %>%
  summarise(count=n())%>%
  arrange(desc(count)) %>%
  rename(searches = count)

contraband_by_age_and_race <- age_grouped_san_diego %>%
  drop_na(subject_age)%>%
  filter(contraband_found == "TRUE")%>%
  group_by(age_group, subject_race) %>%
  summarise(count=n())%>%
  arrange(desc(count)) %>%
  rename(contraband = count)

race_percentage_search_contraband <- contraband_by_age_and_race %>%
    inner_join(searches_by_age_and_race, by=c("age_group","subject_race"))

race_percentage_search_contraband <- race_percentage_search_contraband %>%
  mutate(percent_contraband=(contraband/searches)*100) %>%
  arrange(desc(percent_contraband))

stops_by_age_and_race <- age_grouped_san_diego %>%
  drop_na(subject_age, subject_race)%>%
  group_by(age_group, subject_race) %>%
  summarise(count=n())%>%
  arrange(desc(count)) %>%
  rename(stops = count)

stops_percentage_searches <- stops_by_age_and_race %>%
  inner_join(searches_by_age_and_race, by=c("age_group","subject_race"))

stops_percentage_searches <- stops_percentage_searches %>%
  mutate(percent_searched=(searches/stops)*100) %>%
  arrange(desc(percent_searched))

race_percentage_stops_search_contraband <- race_percentage_search_contraband %>%
  inner_join(stops_percentage_searches, by=c("age_group","subject_race","searches"))

```

**Question 5**
Where are these stops with the identified inconsistencies and race happening? Is there a concentration in a certain area? Does that area have high populations of a certain race?

**Answer**

```{r}
mega_stops<-age_grouped_san_diego%>%
  drop_na(subject_age,)%>%
    drop_na(subject_race)%>%
  group_by(age_group, subject_race,service_area) %>%
  summarise(count=n())%>%
   arrange(desc(count))

mega_searches <- age_grouped_san_diego %>%
  drop_na(subject_age)%>%
  drop_na(subject_race)%>%
  filter(search_conducted == "TRUE")%>%
  group_by(age_group, subject_race, service_area) %>%
  summarise(count=n())%>%
  arrange(desc(count))

mega_seaches_mega_stops<-mega_stops%>%
  inner_join(mega_searches, by=c("age_group","subject_race", "service_area"))%>%
  rename(stops=count.x, searches=count.y)

percent_mega_seaches_mega_stops <- mega_seaches_mega_stops %>%
  mutate(percent_searched=(searches/stops)*100) %>%
  arrange(desc(percent_searched))

```